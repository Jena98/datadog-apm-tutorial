---
version: 0.2
phases:
  install:
    runtime-versions:
      java: corretto11
  pre_build:
    commands:
    - echo -------- Logging in to Amazon ECR  --------
    - aws --version
    - aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin 031393287108.dkr.ecr.ap-northeast-2.amazonaws.com
    - echo -------- Datadog APM Agent Install  --------
    - mkdir -p ./src/main/jib/datadog
    - curl -Lo dd-java-agent.jar https://repo1.maven.org/maven2/com/datadoghq/dd-java-agent/1.37.1/
    - mv dd-java-agent.jar src/main/jib/datadog/dd-java-agent.jar 
  build:
    on-failure: ABORT
    commands:
    - echo -------- Build started on `date` --------
    - ./gradlew :jib
